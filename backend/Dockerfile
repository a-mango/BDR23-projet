FROM maven:3.9-eclipse-temurin-21-jammy

ARG POSTGRESQL_HOST
ARG POSTGRESQL_USERNAME
ARG POSTGRESQL_PASSWORD
ARG POSTGRESQL_DATABASE
ARG POSTGRESQL_POSTGRES_PASSWORD

ENV POSTGRESQL_HOST ${POSTGRESQL_HOST}
ENV POSTGRESQL_USERNAME ${POSTGRESQL_USERNAME}
ENV POSTGRESQL_PASSWORD ${POSTGRESQL_PASSWORD}
ENV POSTGRESQL_DATABASE ${POSTGRESQL_DATABASE}
ENV POSTGRESQL_POSTGRES_PASSWORD ${POSTGRESQL_POSTGRES_PASSWORD}

LABEL Name=backend Version=0.0.1
WORKDIR /app
COPY . /app
COPY wait-for.sh /wait-for.sh

RUN chmod +x /wait-for.sh
RUN apt-get update && apt-get install -y postgresql-client
RUN mvn clean install

EXPOSE 7000

CMD ["/wait-for.sh", "postgresql", "java", "-jar", "target/*-SNAPSHOT-jar-with-dependencies.jar"]